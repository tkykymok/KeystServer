-- 管理者 初期表示
SELECT
    KEYST0300.RESERVE_ID
     , KEYST0300.IMPL_YEAR_MONTH
     , KEYST0300.MANAGER_ID
     , KEYST0300.TEAM
     , KEYST0310.RESERVE_DATE
     , KEYST0310.RESERVE_TIME
     , KEYST0310.USER_ID
     , KEYST0310.USER_COMMENT
     , KEYST0310.MANAGER_COMMENT
     , KEYST0310.REMARK
     , KEYST0310.FEELING
     , KEYST0100.USER_NAME
     , KEYST0310.VERSION_EX_KEY
FROM KEYST0300
         LEFT OUTER JOIN KEYST0310 ON
    KEYST0300.RESERVE_ID = KEYST0310.RESERVE_ID
         LEFT OUTER JOIN KEYST0100 ON
    KEYST0310.USER_ID = KEYST0100.USER_ID
WHERE KEYST0300.MANAGER_ID = '#{managerId}'
  AND KEYST0300.IMPL_YEAR_MONTH = '#{implYearMonth}'
;

-- 一般ユーザー 初期表示
SELECT
    KEYST0300.RESERVE_ID
     , KEYST0300.IMPL_YEAR_MONTH
     , KEYST0300.MANAGER_ID
     , KEYST0300.TEAM
     , KEYST0310.RESERVE_DATE
     , KEYST0310.RESERVE_TIME
     , KEYST0310.USER_ID
     , KEYST0310.USER_COMMENT
     , KEYST0310.MANAGER_COMMENT
     , KEYST0310.REMARK
     , KEYST0310.FEELING
     , KEYST0100.USER_NAME
     , KEYST0310.VERSION_EX_KEY
FROM KEYST0300
         LEFT OUTER JOIN KEYST0310 ON
    KEYST0300.RESERVE_ID = KEYST0310.RESERVE_ID
         LEFT OUTER JOIN KEYST0100 ON
    KEYST0310.USER_ID = KEYST0100.USER_ID
WHERE KEYST0300.TEAM = '#{team}'
  AND KEYST0300.IMPL_YEAR_MONTH = '#{implYearMonth}'
;

-- 実施年月選択リスト
SELECT DISTINCT
    KEYST0300.IMPL_YEAR_MONTH
FROM KEYST0300
ORDER BY IMPL_YEAR_MONTH
;

-- コメント履歴一覧取得
SELECT
    KEYST0300.RESERVE_ID
     , KEYST0300.IMPL_YEAR_MONTH
     , KEYST0310.RESERVE_DATE
     , KEYST0310.RESERVE_TIME
     , KEYST0100.USER_NAME AS MANAGER_NAME
     , KEYST0310.USER_COMMENT
     , KEYST0310.MANAGER_COMMENT
     , KEYST0310.VERSION_EX_KEY
FROM KEYST0300
         INNER JOIN KEYST0310 ON
        KEYST0300.RESERVE_ID = KEYST0310.RESERVE_ID
         INNER JOIN KEYST0100 ON
        KEYST0300.MANAGER_ID = KEYST0100.USER_ID
WHERE KEYST0310.USER_ID = '#{userId}'
ORDER BY IMPL_YEAR_MONTH DESC
;
